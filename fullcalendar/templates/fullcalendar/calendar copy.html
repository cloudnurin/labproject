{% load static %}
{% csrf_token %}
<!DOCTYPE html>
<html>
   <head>
      <title>カレンダーサンプル</title>
      <link rel="stylesheet" href="{% static 'fullcalendar/calendar/css/fullcalendar.min.css' %}"/>
      <link rel="stylesheet" href="{% static 'fullcalendar/calendar/css/style.css' %}">
      <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
      <script type="text/javascript" src="{% static 'fullcalendar/calendar/js/moment.min.js' %}"></script>
      <script type="text/javascript" src="{% static 'fullcalendar/calendar/js/fullcalendar.min.js' %}"></script>
      <script type="text/javascript" src="{% static 'fullcalendar/calendar/lang/ja.js' %}"></script>
      <script>
         // ページ読み込み時の処理
         $(document).ready(function () {

         // カレンダーの設定
         $('#calendar').fullCalendar({
            height: 550,
            lang: "ja",
            header: {
               left: 'prev,next today',
               center: 'title',
               right: 'month,basicWeek,basicDay'
            },
            events: [
                    {% for event in events %}
                        {
                            title: "{{ event.title}}",
                            start: '{{ event.start|date:"Y-m-d" }}',
                            end: '{{ event.end|date:"Y-m-d" }}',
                            id: '{{ event.id }}',
                        },
                    {% endfor %}
                ],
            timeFormat: 'HH:mm',
            selectable: true,
            selectHelper: true,
            navLinks: true,
            // eventSources: [{
            // 　 url: '/fullcalendar/calendar',
            //    dataType: 'json',
            //    async: false,
            //    type : 'GET',
            //    error: function() {
            //       $('#script-warning').show();
            //    }
            // }],
            select: function(start, end, resource) {
               var title = prompt("予定タイトル:");
               var eventData;
               if (title) {
                  eventData = {
                     title: title,
                     start: start,
                     end: end,
                     allDay: true,
                  };
                  $('#calendar').fullCalendar('renderEvent', eventData, true);
                  $.ajax({
                     url: '/fullcalendar/add_event',
                     type: "GET",
                     data: JSON.stringify(eventData),
                     success: function(jsonResponse) {
                        alert("予定を登録しました。")
                     },
                     error: function(jsonResponse) {
                        alert("cannot insert!")
                     }
                  });
               }
               $('#calendar').fullCalendar('unselect');
               },
               editable: true,
               eventLimit: true,
            });        
            });
      </script>
   </head>
   <body>
      <div id='calendar'></div>
   </body>
</html>